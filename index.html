<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ameeri Services - Job Card</title>
<style>
body {font-family: Arial, sans-serif; background:#f5f7fb; padding:20px;}
.job-card {width:800px; margin:0 auto; background:white; padding:20px; border-radius:10px; box-shadow:0 0 20px rgba(0,0,0,0.1);}
label {display:block; margin-bottom:5px; font-weight:bold;}
input, select {width:100%; padding:8px; margin-bottom:15px; border-radius:4px; border:1px solid #ddd;}
.parts-table {width:100%; border-collapse: collapse; margin-bottom:15px;}
.parts-table th, .parts-table td {border:1px solid #ddd; padding:8px;}
.parts-table input {width:100%;}
.btn {background:#1a3a8f; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin-right:5px;}
.signature-box {margin-bottom:15px;}
</style>
</head>
<body>

<div class="job-card">
<h2>Ameeri Services - Job Card</h2>

<form id="jobCardForm">
  <label for="date">Date</label>
  <input type="date" id="date" required>

  <label for="workOrderNo">Work Order No</label>
  <input type="text" id="workOrderNo" required>

  <label for="vehicleNo">Vehicle No</label>
  <input type="text" id="vehicleNo">

  <label for="companyName">Company Name</label>
  <input type="text" id="companyName">

  <label for="userName">Name of User/Driver</label>
  <input type="text" id="userName">

  <label for="mileage">Mileage</label>
  <input type="text" id="mileage">

  <label for="year">Year</label>
  <input type="text" id="year">

  <label for="make">Make</label>
  <input type="text" id="make">

  <label for="model">Model</label>
  <input type="text" id="model">

  <h3>Parts/Services</h3>
  <table class="parts-table">
    <thead>
      <tr>
        <th>Part/Item</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Service Performed</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="partsBody">
      <tr>
        <td><input type="text" placeholder="Part/Item"></td>
        <td><input type="number" value="1" min="1"></td>
        <td><input type="number" value="0" step="0.001"></td>
        <td><input type="text" placeholder="Service"></td>
        <td><button type="button" class="btn" onclick="removeRow(this)">Remove</button></td>
      </tr>
    </tbody>
  </table>
  <button type="button" class="btn" onclick="addRow()">+ Add Part/Service</button>

  <h3>Totals</h3>
  <label>Total Parts</label>
  <input type="number" id="totalParts" readonly value="0">
  <label>Labour</label>
  <input type="number" id="labour" value="0" step="0.001" onchange="calculateTotals()">
  <label>Grand Total</label>
  <input type="number" id="grandTotal" readonly value="0">

  <h3>Signatures</h3>
  <div class="signature-box">
    <label>Mechanic Signature</label>
    <input type="file" id="mechanicFile" accept="image/*">
  </div>
  <div class="signature-box">
    <label>User/Driver Signature</label>
    <input type="file" id="driverFile" accept="image/*">
  </div>
  <div class="signature-box">
    <label>Vehicle Manager Signature</label>
    <input type="file" id="managerFile" accept="image/*">
  </div>

  <button type="button" class="btn" onclick="saveJobCard()">Save Job Card</button>
</form>
</div>

<script>
document.getElementById('date').valueAsDate = new Date();

function addRow() {
  const tbody = document.getElementById('partsBody');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" placeholder="Part/Item"></td>
    <td><input type="number" value="1" min="1" onchange="calculateTotals()"></td>
    <td><input type="number" value="0" step="0.001" onchange="calculateTotals()"></td>
    <td><input type="text" placeholder="Service"></td>
    <td><button type="button" class="btn" onclick="removeRow(this)">Remove</button></td>
  `;
  tbody.appendChild(tr);
  calculateTotals();
}

function removeRow(btn) {
  btn.closest('tr').remove();
  calculateTotals();
}

function calculateTotals() {
  const rows = document.querySelectorAll('#partsBody tr');
  let total = 0;
  rows.forEach(r => {
    const qty = parseFloat(r.cells[1].children[0].value) || 0;
    const price = parseFloat(r.cells[2].children[0].value) || 0;
    total += qty*price;
  });
  document.getElementById('totalParts').value = total.toFixed(3);
  const labour = parseFloat(document.getElementById('labour').value) || 0;
  document.getElementById('grandTotal').value = (total + labour).toFixed(3);
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function saveJobCard() {
  calculateTotals();
  const partsData = [];
  document.querySelectorAll('#partsBody tr').forEach(row => {
    partsData.push({
      partName: row.cells[0].children[0].value,
      qty: row.cells[1].children[0].value,
      price: row.cells[2].children[0].value,
      service: row.cells[3].children[0].value
    });
  });

  // Convert files to base64
  const mechanicFile = document.getElementById('mechanicFile').files[0];
  const driverFile = document.getElementById('driverFile').files[0];
  const managerFile = document.getElementById('managerFile').files[0];

  const mechanicBase64 = mechanicFile ? await fileToBase64(mechanicFile) : '';
  const driverBase64 = driverFile ? await fileToBase64(driverFile) : '';
  const managerBase64 = managerFile ? await fileToBase64(managerFile) : '';

  const payload = {
    date: document.getElementById('date').value,
    workOrderNo: document.getElementById('workOrderNo').value,
    vehicleNo: document.getElementById('vehicleNo').value,
    companyName: document.getElementById('companyName').value,
    userName: document.getElementById('userName').value,
    mileage: document.getElementById('mileage').value,
    year: document.getElementById('year').value,
    make: document.getElementById('make').value,
    model: document.getElementById('model').value,
    totalParts: document.getElementById('totalParts').value,
    labour: document.getElementById('labour').value,
    grandTotal: document.getElementById('grandTotal').value,
    partsData,
    mechanicSignature: mechanicBase64,
    driverSignature: driverBase64,
    managerSignature: managerBase64
  };

  // Google Apps Script Web App URL
  const SCRIPT_URL = 'YOUR_APPS_SCRIPT_WEBAPP_URL_HERE';

  try {
    const res = await fetch(SCRIPT_URL, {
      method:'POST',
      body: JSON.stringify(payload),
      headers: {'Content-Type': 'application/json'}
    });
    const data = await res.json();
    alert(data.message || 'Saved!');
  } catch(err) {
    alert('Failed to save: ' + err);
  }
}
</script>
</body>
</html>

